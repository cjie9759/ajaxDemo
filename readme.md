# 前后端分离开发 教学demo

## 前言

*    前后端分离开发是当前非常热门的技术方向，可以说是互联网项目开发的标配。
*    前后端分离 (解耦) 的核心思想是：前端 Html 页面通过 Ajax 调用后端的 API 并使用 Json 数据进行交互。

### 历史发展

#### 前后端分离前
*    前后端未分离时代，页面逻辑处理以及页面渲染全部由后端完成。如最具代表性的 MVC 三层框架。用户发起请求至服务端控制层（Controller），控制层通过调用模型处理器（Model）以及渲染视图（View）并最终将页面返回给客户端。
*    视图与模型均放在后端处理，致使前端代码无法独立上线运行。此种架构，要求后端研发关注前端 HTML、CSS 代码等。前端无法单独调试，前后端无法并行开发，后期维护成本较高，

![mvc](http://image.woshipm.com/wp-files/2020/01/31uTyHEHrSHJS75Cue1i.png)

*    有意思的事情出现了，内容是传给用户的，前端并不是直接接触用户的！前端只是提供了个样式模板，由后端把内容嵌入进入，再由后端直接传给用户。
*    这个时候，前端的编程要各种顺着后端哥哥的心意，而且前端要是出bug了，还得拉上后端一起研究，谁让你往我的模板里插了内容，出了幺蛾子你就得负责到底。
*    这个时期前后端高度耦合，从编程环境、到开发调试，都必须“在一起”，对于前端来说，其实自主权就不高，对后端来说，也要懂一些前端的知识。
*    于是前端程序猿对后端程序猿说，要不……你只管你的业务和数据，把结果给我，我来负责组装与呈现，这样大家都轻松些。于是前后端就分离了。

#### 前后端分离1.0

![](http://image.woshipm.com/wp-files/2020/01/WhzL5IuOk1buyuHfx4uF.png)

前后端分离带来的好处：

* (1)编程更轻松

    *    前后端分离之后，后端更专注于实现业务逻辑，形成一套标准化的“API接口”，例如需要创建商品，前端将商品信息传给后端创建商品的接口，后端就会完成商品的创建，并返回创建结果。如果前端给的创建商品信息缺了标题或者价格，后端还能返回创建失败的结果，并且提示缺失了哪些信息等。

    *    前端除了负责界面样式和交互，还接管了获取和展示数据的权利，从此前端开发就自由多了，如果遇上bug，也能很轻松定位到是前端还是后台的事情。

* (2)更高的可复用性

    *    前后端分离，更是顺应了互联网发展多样化的潮流。后端通过提供一系列可以实现不同业务功能的接口，就可以让不同的前端、甚至外部系统过来对接。

    *    这样方便了公司不断推广自己的产品，今天推出手机网页版、明天推出APP版、后天推出小程序版本等。而后端只需要提供一次接口，无需每增加一类客户端，后端就要新写过。

* (3)降低服务器压力
    *    部分耗费资源的计算可以下放到客户端进行，降低服务器的负载。

    *    但是久而久之，前后端分离在web网页上也遇到了一些问题，最明显的是以下两点：

    *    JavaScript的请求在用户浏览器中进行，当一个网站需要展示非常多的内容时，JavaScript就要向后台多个接口请求数据，然后再在用户浏览器上完成页面组装，这过程中就会给用户设备的网速、设备的运行速度（CPU、内存等）带来一定的压力。

    *    搜索引擎，如百度、搜狗、谷歌等，想爬取网页的内容时，就会用到爬虫。爬虫会抓取网页HTML里面的内容，然后让其他网友可以搜索到你的网页。但是此时，HTML文件就是个框架，要依靠JavaScript才能获取到数据。这就会导致你的网页难以被搜索引擎收录，用户很可能搜不到你的网页。(SEO)

![](http://image.woshipm.com/wp-files/2020/01/cBwnl4wIvJxqPCcEvKDI.png)

* ps 用户访问网站的过程小知识：

    *    浏览器先下载HTML的内容
    *    根据HTML里的内容，下载并加载对应的CSS，让网页漂亮起来
    *    根据HTML里的内容，下载并加载对应的JavaScript，让网站具备交互动效，其中部分JavaScript代码负责向服务器上的后端请求数据，并展示在页面上。

#### 前后端分离2.0

*    考虑到上诉问题，聪明的网页前端程序猿就想到了一个新的办法，那我们先把后台的数据跟HTML内容整合好，再呈现给用户吧，得力于一种叫做Node.JS的、可以使用网页前端熟悉的JavaScript编程的工具，于是有了2.0版本的前后端分离。

![](http://image.woshipm.com/wp-files/2020/01/gs844w9VZ0YuqqJAIO6f.png)

*    前端程序猿跟服务器上的后端说，让一让，给我腾个地儿，然后把Node.JS放在了服务器上。等用户或者爬虫需要访问网页时，这个运行在服务器上的程序，先请求后端获得数据，并整合到HTML中，然后再返回给用户。

*    这样一来，用户的设备就少了JavaScript多次请求后端的烦恼，加快了运行速度，而爬虫也可以爬取到填充好内容的HTML网页了。

*    看到这里，小汪就想，这么一来，用户体验、爬虫的问题确实解决了，但是让本来本该发生在用户浏览器上的事情，都在服务器上做了嘛，如果访问量大的话，咱服务器的压力不就很大了？

*    前端程序猿哥哥呵呵一笑，其实不然，你想想，很多用户都是在访问同一个网页，看同一个商品、读同一篇文章，这些请求，要是服务器的前端就请求后台一次，然后把整合好的HTML保存起来，下次再有人再来访问，就把这个生成好的HTML展示给用户，这样不就服务器轻松了、用户访问也快了么！

*    小汪又问了，那咋们页面多了，不就要每个页面都保存一份HTML文件么，服务器储存的空间不就越来越少了么？

*    前端程序猿哥哥继续答道：久而久之，HTML文件在服务器积累多了，就把好久都没人访问的HTML删了，给其他新保存的HTML文件让位置，通过“缓存”技术，让服务器永葆活力。

常见框架 Vue3 React

<!-- ## 为什么前后端分离

    一般公司后端开发人员直接兼顾前端的工作，一边实现 API 接口，一边开发页面，两者互相切换着做，而且根据不同的 url 动态拼接页面，这也导致后台的开发压力大大增加。前后端工作分配不均。不仅仅开发效率慢，而且代码难以维护。

    而前后端分离的话，则可以很好的解决前后端分工不均的问题，将更多的交互逻辑分配给前端来处理，而后端则可以专注于其本职工作，比如提供 API 接口，进行权限控制以及进行运算工作。而前端开发人员则可以利用 nodejs 来搭建自己的本地服务器，直接在本地开发，然后通过一些插件来将 api 请求转发到后台，这样就可以完全模拟线上的场景，并且与后台解耦。前端可以独立完成与用户交互的整一个过程，两者都可以同时开工，不互相依赖，开发效率更快，而且分工比较均衡。 -->

## 示例demo

### 基础信息

*    该demo为一个获取服务器时间的页面
*    一个简易的前后分离1.0的示例demo
### 分离前
~~~ php
<!DOCTYPE html>

<head>
    <title>前后端分离前</title>
</head>

<body>
    服务器时间:<input type="text" value="
    <?php
    $time = date("H:i:s");
    echo $time;
    ?>
    ">

</body>

~~~
### 分离后
#### 接口文档
~~~ markdown
### **Ajax demo**
###### 接口功能
> 获取服务器时间

###### URL
> /api/getime.php

###### 支持格式
> JSON

###### HTTP请求方式
> GET

###### 请求参数
null

###### 返回字段
| 返回字段  | 字段类型 | 说明                             |
| :-------- | :------- | :------------------------------- |
| err       | int      | 返回结果状态。0：正常；1：错误。 |
| msg       | string   | 错误信息                         |
| data      | object   | 数据                             |
| data.time | string   | 服务器时间                       |

###### 接口示例
> [/api/getime.php](/api/getime.php)
``` javascript
{
    "err": 0,
    "msg": ""
    "data":{
        "time":"12:12:12"
    }
}
```
~~~
#### 前端
~~~ html
<!DOCTYPE html>

<head>
    <title>前后端分离前</title>
    <!-- 引入jquery -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
</head>

<body>
    服务器时间:<input type="text" value="">
</body>
<script type="text/javascript">
    // 发送ajax 请求至后端
    $.get("/api/getime.php", function(data) {
        // 获取数据（data.data.time）并渲染至页面
        $("input").val(data.data.time);
        // console.log(data);
    });
</script>
~~~
#### 后端
~~~ php
<?php
$time = date("H:i:s");
$data = [
    "err" => 0,
    "msg"=>null,
    "data"=>[
        "time"=>$time
    ]
];
echo json_encode($data);

~~~